<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>楽天市場 商品名ワード頻度分析</title>
  <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css">
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
  <script src="//maxcdn.bootstrapcdn.com/bootstrap/3.3.5/js/bootstrap.min.js"></script>
  <style>
    body { padding-top: 30px; }
    .freq-bar {
      background-color: #d9534f;
      height: 20px;
      border-radius: 3px;
      transition: width 0.3s;
    }
    .freq-table td { vertical-align: middle !important; }
    #results { margin-top: 20px; }
    .product-list { margin-top: 20px; }
    .product-list li { margin-bottom: 4px; font-size: 13px; color: #666; }
  </style>
</head>
<body>
  <div class="container">
    <h1>楽天市場 商品名ワード頻度分析</h1>
    <p class="text-muted">キーワードで検索し、上位30件の商品名に含まれる単語の出現回数を集計します。</p>

    <div class="well">
      <form id="searchForm" class="form-inline">
        <div class="form-group">
          <label for="appId">アプリID:</label>
          <input type="text" id="appId" class="form-control" placeholder="楽天APIアプリID" style="width: 280px;">
        </div>
        <div class="form-group" style="margin-left: 10px;">
          <label for="keyword">キーワード:</label>
          <input type="text" id="keyword" class="form-control" placeholder="例: プロテイン" style="width: 200px;">
        </div>
        <button type="submit" class="btn btn-primary" style="margin-left: 10px;">検索</button>
      </form>
      <p class="help-block" style="margin-top: 8px;">
        アプリIDは <a href="https://webservice.rakuten.co.jp/" target="_blank">Rakuten Developers</a> で取得できます。
      </p>
    </div>

    <div id="loading" style="display: none;">
      <p><span class="glyphicon glyphicon-refresh"></span> 検索中...</p>
    </div>

    <div id="error" class="alert alert-danger" style="display: none;"></div>

    <div id="results" style="display: none;">
      <h3>単語出現頻度 <small id="resultMeta"></small></h3>

      <div class="form-group">
        <label>
          <input type="number" id="minCount" value="2" min="1" max="100" style="width: 60px;">
          回以上の単語を表示
        </label>
        <label style="margin-left: 15px;">
          <input type="checkbox" id="filterStopwords" checked> 助詞・記号を除外
        </label>
      </div>

      <table class="table table-striped freq-table" id="freqTable">
        <thead>
          <tr>
            <th style="width: 50px;">#</th>
            <th style="width: 200px;">単語</th>
            <th style="width: 80px;">回数</th>
            <th>割合</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>

      <div class="product-list">
        <h4>取得した商品名一覧 (<span id="itemCount"></span>件)</h4>
        <ol id="productList"></ol>
      </div>
    </div>
  </div>

<script>
// TinySegmenter -- Super compact Japanese tokenizer in Javascript
// (c) 2008 Taku Kudo <taku@chasen.org>
// TinySegmenter is freely distributable under the terms of a new BSD licence.
function TinySegmenter(){var t={"\u4E00":2,"\u4E8C":3,"\u4E09":4,"\u56DB":5,"\u4E94":6,"\u516D":7,"\u4E03":8,"\u516B":9,"\u4E5D":10,"\u5341":11,"\u767E":12,"\u5343":13,"\u4E07":14,"\u5104":15,"\u5146":16,"\u4E00":2,"\u4E8C":3,"\u4E09":4,"\u56DB":5,"\u4E94":6,"\u516D":7,"\u4E03":8,"\u516B":9,"\u4E5D":10,"\u5341":11,"\u767E":12,"\u5343":13,"\u4E07":14,"\u5104":15,"\u5146":16};this.chartype_=function(e){if(e.match(/[A-Za-z\uFF21-\uFF3A\uFF41-\uFF5A]/))return"A";if(e.match(/[0-9\uFF10-\uFF19]/))return"N";if(e.match(/[\u4E00-\u9FFF\uF900-\uFAFF\u3400-\u4DBF]/))return"H";if(e.match(/[\u3041-\u309F]/))return"I";if(e.match(/[\u30A1-\u30FF\u31F0-\u31FF\uFF66-\uFF9F]/))return"K";return"O"};this.ts_=function(e){return e||0};this.BIAS__=-332;this.BC1__={"HH":6,"II":2461,"KH":406,"OH":-1378};this.BC2__={"AA":-3267,"AI":2744,"AN":-878,"HH":-4070,"HM":-1711,"HN":4012,"HO":3761,"IA":1327,"IH":-1184,"II":-1332,"IK":1721,"IO":5492,"KI":3831,"KK":-8741,"MH":-3132,"MK":3334,"OO":-2920};this.BC3__={"HH":996,"HI":626,"HK":-721,"HN":-1307,"HO":-836,"IH":-301,"KK":2762,"MK":1079,"MM":4034,"OA":-1652,"OH":266};this.BP1__={"BB":295,"OB":304,"OO":-125,"UB":352};this.BP2__={"BO":60,"OO":-1762};this.BQ1__={"BHH":1150,"BHM":1521,"BII":-1158,"BIM":886,"BMH":1208,"BNH":449,"BOH":-91,"BOO":-2597,"OHI":451,"OIH":-296,"OKA":1851,"OKH":-1020,"OKK":904,"OOO":2965};this.BQ2__={"BHH":118,"BHI":-1159,"BHM":466,"BIH":-919,"BKK":-1720,"BKO":864,"OHH":-1139,"OHM":-181,"OIH":153,"OKI":-1241,"OKO":852,"OOO":-1683};this.BQ3__={"BHH":-792,"BHI":2664,"BII":-299,"BKI":419,"BMH":937,"BMM":8335,"BNN":998,"BOH":775,"OHH":2174,"OHM":439,"OII":280,"OKH":1798,"OKI":-793,"OKO":-2242,"OMH":-2402,"OOO":11699};this.BQ4__={"BHH":-3895,"BIH":3761,"BII":-4654,"BIK":1348,"BKK":-1806,"BMI":-3385,"BOO":-12396,"OAH":926,"OHH":266,"OHK":-2036,"ONN":-973};this.BW1__={",\u3068":660,",\u540C":727,"\u3068\u306E":-910,"\u306B\u3082":-100,"\u306B\u4E00":-1286,"\u306E\u304B":1486,"\u306E\u5F8C":530,"\u308C\u304B":-1089,"\u30FB\u30FB":-1186};this.BW2__={"..":-11822,11:-669,"\u2015\u2015":-5730,"\u2212\u2212":-13175,"\u3044\u3046":-1609,"\u3046\u304B":2490,"\u304B\u3082":-1350,"\u304B\u3089":-602,"\u304B\u308A":-7194,"\u304C\u3044":4612,"\u304C\u3093":853,"\u304D\u305F":-3198,"\u304D\u3067":-1820,"\u304D\u305F":-4065,"\u304D\u3067":-5228,"\u304C\u3044":-2093,"\u3053\u3068":1860,"\u3053\u306E":-1584,"\u3055\u308C":-5765,"\u3055\u3093":860,"\u3057\u3044":2024,"\u3057\u304B":-2880,"\u3058\u3083":-2788,"\u3059\u308B":2169,"\u305A\u3067":1987,"\u305F\u3061":5588,"\u3063\u305F":4413,"\u3063\u3066":-2471,"\u3066\u3044":1664,"\u3066\u304D":3526,"\u3066\u306F":-1883,"\u3068\u3082":-5765,"\u306A\u3044":-9066,"\u306A\u304F":5026,"\u306B\u3082":6005,"\u306E\u3067":-1033,"\u306E\u306B":-1630,"\u308C\u3089":5798,"\u308C\u308B":-1713,"\u308F\u308C":7066,"\u3093\u3060":-1189,"\u3093\u3067":-3157,"\u4E00\u4EBA":568,"\u4E0A\u304C":2477,"\u4E0B\u3055":-1622,"\u4E0D\u660E":-1205,"\u4E16\u754C":6620,"\u4E2D\u5FC3":-528,"\u4E88\u5B9A":551,"\u4E8B\u5B9F":-1384,"\u4E8C\u5E74":1168,"\u4E8B\u524D":1729,"\u4E8C\u4EBA":-2640,"\u4ECA\u5F8C":-2184,"\u4EE3\u8868":-2030,"\u4EE5\u4E0A":7174,"\u4EE5\u4E0B":-3262,"\u4F1A\u793E":-1040,"\u4F1A\u8B70":8348,"\u4F4F\u3080":2623,"\u4F55\u4EBA":-3818,"\u4F59\u308A":1615,"\u4F5C\u696D":-1286,"\u5143\u5E02":-2178,"\u5148\u751F":2069,"\u515A\u5185":-7473,"\u5168\u56FD":-2208,"\u5185\u5BB9":6181,"\u5168\u4F53":-1471,"\u516C\u958B":-1014,"\u540C\u515A":2183,"\u540C\u65E5":-428,"\u5927\u962A":3500,"\u5927\u304D":-3116,"\u5929\u7687":-3030,"\u592A\u90CE":-1246,"\u540C\u4E00":1455,"\u4E0D\u660E":-2243,"\u5E74\u5EA6":-1387,"\u5F8C\u534A":-1834,"\u65E5\u672C":-2282,"\u65E5\u672C":-2194,"\u65E5\u7C73":7281,"\u66F4\u65B0":-3394,"\u6708\u65E5":-487,"\u672B\u306E":1169,"\u6771\u4EAC":1667,"\u6B21\u306E":-3508,"\u6C11\u4E3B":-4411,"\u6C0F\u306E":-3886,"\u7D30\u304B":3575,"\u793E\u4F1A":-2522,"\u7ACB\u3066":1904,"\u898B\u308B":4220,"\u8ABF\u67FB":-3298,"\u8C37\u533A":-3745,"\u8CC7\u6599":-2446,"\u8FD1\u304F":5765,"\u9078\u6319":-22222,"\u9577\u91CE":-5765,"\u958B\u50AC":-5147,"\u96C6\u4E2D":2860,"\u98DF\u6599":-1040};this.BW3__={"\u3042\u305F":-4003,"\u3044\u3046":2744,"\u304C\u5927":-3727,"\u5BFE\u3057":-2591,"\u305F\u3061":2744,"\u3067\u3059":-2291,"\u3068\u3044":-1230,"\u3068\u3053":-2591,"\u306E\u304B":-2291,"\u306E\u3067":6353,"\u306E\u306B":-1230,"\u306E\u3092":-2291,"\u308C\u305F":2744,"\u3093\u3060":-4003,"\u4F1A\u793E":2764,"\u5927\u304D":3919,"\u5C11\u3057":-2291,"\u601D\u3044":1230,"\u65B0\u805E":3350,"\u65E5\u672C":3350,"\u65E5\u7C73":1230,"\u6708\u65E5":-2291,"\u672B\u306E":1230,"\u8A00\u3063":2764,"\u8ABF\u67FB":-1230,"\u8C37\u533A":-2291};this.TC1__={"AAA":1093,"HHH":1029,"HHM":580,"HII":998,"HOH":-390,"HOM":-331,"IHI":1169,"IOH":-142,"IOI":-1015,"IOM":467,"MMH":187,"OOI":-1832};this.TC2__={"HHO":2088,"HII":-1023,"HMM":-1154,"IHI":-1965,"KKH":703,"OII":-2649};this.TC3__={"AAA":-294,"HHH":346,"HHI":-341,"HII":-1088,"HIK":731,"HOH":-1486,"IHH":128,"IHI":-3041,"IHO":-1935,"IIH":-825,"IIM":-1035,"IOI":-542,"KHH":-1216,"KKA":491,"KKH":-1217,"KOK":-1009,"MHH":-2694,"MHM":-457,"MHO":123,"MMH":-471,"NNH":-1689,"NNO":662,"OHO":-3393};this.TC4__={"HHH":-203,"HHI":1344,"HHK":365,"HHM":-122,"HHN":182,"HHO":669,"HIH":804,"HII":679,"HOH":446,"IHH":695,"IHO":-2324,"IIH":321,"III":1497,"IIO":656,"IOO":54,"KAK":4845,"KKA":3386,"KKK":3065,"MHH":-405,"MHI":201,"MMH":-241,"MMM":661,"MOM":841};this.TQ1__={"BHHH":-227,"BHHI":316,"BHIH":-132,"BIHH":60,"BIII":1595,"BNHH":-744,"BOHH":225,"BOOO":-908,"OAKK":482,"OHHH":281,"OHIH":249,"OIHI":200,"OIIH":-68};this.TQ2__={"BIHH":-1401,"BIII":-1033,"BKAK":-543,"BOOO":-5591};this.TQ3__={"BHHH":478,"BHHM":-1073,"BHIH":222,"BHII":-504,"BIIH":-116,"BIII":-105,"BMHI":-863,"BMHM":-464,"BOMH":620,"OHHH":346,"OHHI":1729,"OHII":997,"OHMH":481,"OIHH":623,"OIIH":1344,"OKAK":2792,"OKHH":587,"OKKA":679,"OOHH":110,"OOII":-685};this.TQ4__={"BHHH":-721,"BHHM":-3604,"BHII":-966,"BIIH":-607,"BIII":-2181,"OAAA":-2763,"OAKK":180,"OHHH":-294,"OHHI":2446,"OHHO":480,"OHIH":-1573,"OIHH":1935,"OIHI":-493,"OIIH":626,"OIII":-4007,"OKAK":-8156};this.TW1__={"\u306B\u3064\u3044":-4681,"\u6771\u4EAC\u90FD":2026};this.TW2__={"\u3042\u308B\u7A0B":-2049,"\u3044\u3063\u305F":-1256,"\u3053\u308D\u304C":-2434,"\u3057\u3087\u3046":3873,"\u305D\u306E\u5F8C":-4430,"\u3060\u3063\u3066":-1049,"\u3066\u3044\u305F":1833,"\u3068\u3057\u3066":-4657,"\u3068\u3082\u306B":-4517,"\u3082\u306E\u3067":1882,"\u4E00\u6C17\u306B":-792,"\u521D\u3081\u3066":-1512,"\u540C\u3058\u304F":8576,"\u5927\u304D\u306A":-168,"\u5C0F\u3055\u306A":1167,"\u65E5\u672C\u4EBA":-3896,"\u672C\u5F53\u306B":-2249,"\u7684\u306A\u306E":-2578};this.TW3__={"\u3044\u305F\u3060":-1372,"\u304D\u3087\u3046":-929,"\u3057\u3087\u3046":-1740,"\u305D\u3046\u3044":2110,"\u305D\u3046\u3057":1464,"\u305D\u3046\u3057":-3820,"\u305D\u306E\u5F8C":1802,"\u305D\u308C\u3067":7082,"\u305D\u308C\u3092":5765,"\u305F\u3061\u304C":860,"\u3068\u306A\u308B":2901,"\u3068\u306E\u65B9":-1110,"\u3068\u3082\u306B":4612,"\u306A\u3044\u3088":1697,"\u306A\u304F\u306A":4552,"\u306A\u3063\u305F":2592,"\u306B\u3064\u3044":5765,"\u306B\u3064\u3044":-865,"\u306B\u306A\u3063":4023,"\u306B\u5F53\u305F":3792,"\u306E\u3067\u3059":4501,"\u306E\u306B\u5BFE":-6380,"\u306E\u306B\u5BFE":-839,"\u306E\u7D50\u679C":-4022,"\u3070\u306A\u3089":4428,"\u3076\u308A\u306B":-2903,"\u3079\u304D\u3060":-3016,"\u307E\u3067\u306E":2479,"\u307E\u3067\u306B":5765,"\u307E\u3067\u306B":5765,"\u307E\u3067\u306B":-1597,"\u307E\u308B\u3067":4023,"\u3082\u306E\u3067":-2244,"\u308F\u304B\u3063":-2691,"\u4E00\u4EBA\u4E00":1169,"\u5927\u304D\u306A":1169,"\u540C\u3058\u304F":1169,"\u65E5\u672C\u306E":-270,"\u958B\u50AC\u306E":-3685};this.TW4__={"\u3044\u3046\u3082":8576,"\u3044\u3063\u305F":1167,"\u3044\u3063\u305F":1167,"\u304B\u3089\u306E":-3896,"\u304F\u306E\u3092":-2578,"\u3053\u3068\u304C":-2578,"\u3053\u3068\u304C":-3896,"\u3055\u305B\u3066":8576,"\u3057\u305F\u306E":1167,"\u3057\u3088\u3046":-792,"\u3059\u308B\u3053":-1512,"\u305D\u3046\u3057":-7092,"\u305D\u306E\u4EBA":4023,"\u305D\u306E\u5F8C":8576,"\u305F\u3081\u306B":-168,"\u3066\u3044\u305F":1167,"\u3066\u304D\u305F":1024,"\u3068\u3044\u3046":8576,"\u3068\u3044\u3046":1167,"\u3068\u304D\u3092":-1930,"\u3068\u3044\u3046":5765,"\u3069\u3046\u304B":-3028,"\u306A\u3044\u306E":-1615,"\u306A\u3063\u305F":1167,"\u306A\u3063\u305F":5765,"\u306B\u306A\u3063":3350,"\u306B\u5BFE\u3057":-168,"\u306B\u3064\u3044":-5765,"\u306E\u3067\u306F":-5765,"\u306E\u3068\u304D":-1286,"\u306E\u306A\u3044":-2602,"\u306E\u306B\u5BFE":-7473,"\u3076\u308A\u306B":-2602,"\u307E\u3060\u307E":-2602,"\u3082\u306E\u306E":8576,"\u3089\u308C\u305F":-2602,"\u308B\u3053\u3068":-2602,"\u308B\u3068\u3044":1167,"\u308C\u304B\u3089":-2602,"\u308C\u305F\u306E":-2602,"\u5165\u308A\u306E":-2602,"\u5165\u308C\u305F":-2602,"\u5927\u304D\u306A":1167,"\u59D4\u54E1\u4F1A":-2602};this.UC1__={"A":484,"H":-2324,"K":-1892,"N":484,"O":484,"U":3267};this.UC2__={"A":241,"H":451,"K":-343,"N":-1019};this.UC3__={"A":-1273,"H":1000,"I":2088,"K":169,"M":-2694,"O":-1273};this.UC4__={"A":-2807,"H":174,"I":-691,"K":-3009,"O":-2807};this.UC5__={"A":836,"I":-1873,"O":-2807};this.UC6__={"A":-4569,"H":4423,"K":2270,"O":3370};this.UP1__={"O":3370};this.UP2__={"O":3370};this.UP3__={"O":4443};this.UQ1__={"BH":2120,"BI":3818,"BK":-855,"BN":3370,"BO":3370,"OH":-1175,"OI":3370,"OK":5765,"OO":3370};this.UQ2__={"BH":4423};this.UQ3__={"BH":3370,"BI":3370,"BK":4423,"BN":3370,"BO":5765,"OH":2120,"OI":3370,"OK":3370};this.UW1__={",":156,"\u3001":156,"\u300C":-463,"\u3042":-941,"\u3046":-127,"\u304C":-553,"\u304D":121,"\u3053":505,"\u3067":-201,"\u3068":-547,"\u3069":-123,"\u306B":-789,"\u306E":-185,"\u306F":-847,"\u3082":-466,"\u3084":-470,"\u3088":182,"\u3089":-292,"\u308A":208,"\u308C":169,"\u3092":-446,"\u3093":-137,"\u30FB":-135,"\u4E3B":-402,"\u4EAC":-268,"\u533A":-912,"\u5348":871,"\u56FD":-460,"\u5927":561,"\u59D4":729,"\u5E02":-411,"\u65E5":-141,"\u7406":361,"\u751F":-408,"\u7537":-386,"\u770C":-718,"\u7ACB":-463,"\u7530":-135};this.UW2__={",":1886,".":3437,"\u300C":743,"\u300D":4493,"\u3042":757,"\u3044":-588,"\u3046":441,"\u304D":268,"\u304F":-685,"\u3054":1228,"\u3055":-1062,"\u3055":1428,"\u3057":3256,"\u3058":-203,"\u305A":379,"\u3068":-986,"\u306A":3371,"\u306B":-640,"\u306E":-341,"\u306F":1384,"\u3079":-428,"\u307E":1407,"\u307F":-727,"\u3082":473,"\u3082":-1057,"\u3082":676,"\u3082":4849,"\u3084":201,"\u308C":215,"\u308F":4286,"\u3093":3596,"\u3093":6929,"\u4E0B":284,"\u4E0B":1726,"\u4E5F":-486,"\u4EE3":620,"\u4F1A":1749,"\u4F4F":1895,"\u4F53":1236,"\u4F55":-185,"\u5148":-528,"\u5168":1080,"\u540C":3365,"\u5316":-869,"\u539F":1938,"\u540C":810,"\u5668":-851,"\u56F3":1286,"\u590F":-3034,"\u5927":1758,"\u5B50":-745,"\u5B66":-1547,"\u5B9A":1706,"\u5E74":-505,"\u5F37":1182,"\u5F53":1756,"\u624B":-1227,"\u653F":-904,"\u65E5":804,"\u660E":4235,"\u6628":3340,"\u6700":-1273,"\u696D":-1014,"\u6C11":990,"\u6C7A":-1512,"\u7027":-244,"\u738B":-480,"\u7ACB":-1084,"\u7ACB":1169,"\u7C73":1169,"\u81EA":117,"\u82F1":-1789,"\u884C":4034,"\u897F":229,"\u8EE2":3405,"\u90CE":121,"\u90FD":1169,"\u91CF":3345,"\u9577":3978};this.UW3__={",":1885,".":3712,"\u300C":6961,"\u300D":1115,"\u300D":2024,"\u3042":-611,"\u3046":-3149,"\u3048":1734,"\u304B":-1507,"\u304D":-1259,"\u304D":-1534,"\u304F":-1820,"\u3051":-2076,"\u3053":1000,"\u3055":-4371,"\u3059":1178,"\u305F":2073,"\u3060":-1299,"\u3063":1749,"\u3066":-1246,"\u3067":5420,"\u3068":3370,"\u306A":-3789,"\u306B":-1656,"\u306E":-772,"\u306E":-2287,"\u306E":-2215,"\u306E":6420,"\u306E":1340,"\u306F":4,"\u306F":5765,"\u3076":-2511,"\u3082":1905,"\u3082":-4198,"\u3084":-568,"\u3088":-3792,"\u3089":491,"\u308A":-3028,"\u308B":-1676,"\u308C":1167,"\u308C":-3375,"\u308F":-1522,"\u3093":-987,"\u3093":5765,"\u30FB":-958,"\u4E00":636,"\u4E09":1169,"\u4E0A":-1789,"\u4E0B":936,"\u4E0D":-1789,"\u4E2D":-1789,"\u4E3B":-1789,"\u4E88":-1789,"\u4E8B":1167,"\u4E8C":-2424,"\u4EBA":3370,"\u4ECA":-2424,"\u4ED5":-1789,"\u4EE3":1849,"\u4F1A":5765,"\u4F53":-922,"\u4F55":1167,"\u4F5C":-1789,"\u4F7F":936,"\u4FE1":-878,"\u5148":1167,"\u515A":-1789,"\u5168":5765,"\u516C":-1789,"\u5171":-878,"\u524D":-2424,"\u526F":-1789,"\u529B":-2424,"\u52D5":-878,"\u52D9":-1789,"\u5316":1167,"\u5317":1849,"\u533A":-2424,"\u5343":-2424,"\u534A":-1789,"\u5357":-878,"\u5358":-1789,"\u53E3":1082,"\u53F0":-1789,"\u540C":-2424,"\u540D":-2424,"\u548C":-878,"\u5546":-4378,"\u56DB":-2424,"\u56DE":-878,"\u56E3":-1789,"\u5730":1849,"\u578B":-878,"\u5834":-878,"\u5916":-878,"\u5927":-2424,"\u5929":1167,"\u592A":-878,"\u5B50":-2424,"\u5B66":4513,"\u5B9F":1167,"\u5BFE":-2424,"\u5C40":-878,"\u5C4B":1167,"\u5C71":-878,"\u5CF6":-878,"\u5DDD":-878,"\u5DDE":-1789,"\u5E02":1167,"\u5E74":-2424,"\u5E83":5765,"\u5F8C":1167,"\u5F97":-1789,"\u5FA9":-1789,"\u5FC3":-2424,"\u601D":-1789,"\u6027":-1789,"\u623F":-1789,"\u624B":-878,"\u6539":-878,"\u653F":-878,"\u6559":-1789,"\u6570":1167,"\u6587":-878,"\u65B0":1167,"\u65B9":-878,"\u65E5":-2424,"\u660E":-2424,"\u6642":-878,"\u66F8":5765,"\u6700":-878,"\u6708":-878,"\u6709":-2424,"\u671D":-878,"\u672C":5765,"\u6765":1167,"\u6771":-2424,"\u696D":-878,"\u6B21":-878,"\u6B74":-2424,"\u6C11":1167,"\u6C17":-878,"\u6C34":-878,"\u6C7A":-878,"\u6CBB":-878,"\u6CD5":-878,"\u6D77":-878,"\u70B9":-1789,"\u7269":-878,"\u73FE":3370,"\u7406":-878,"\u751F":-878,"\u7523":-878,"\u7530":-878,"\u7537":-2424,"\u7684":1167,"\u76F4":-2424,"\u7701":-878,"\u7701":-878,"\u77E5":-878,"\u77F3":1167,"\u793E":-2424,"\u795E":-878,"\u798F":1167,"\u7A7A":-878,"\u7ACB":-878,"\u7B2C":-1789,"\u7C73":1849,"\u7D30":-878,"\u7D44":-878,"\u7D4C":-878,"\u7D50":1167,"\u7D9A":-878,"\u7DCF":-1789,"\u7F8E":-878,"\u8077":1167,"\u80FD":-878,"\u81EA":-2424,"\u82B1":-878,"\u82F1":-878,"\u898B":-878,"\u8A18":-878,"\u8A9E":-878,"\u8ABF":-878,"\u8B70":-878,"\u8CA0":-878,"\u8CBB":-878,"\u8ECA":-878,"\u8ECD":-878,"\u8FBC":-878,"\u8FD1":-878,"\u9053":1167,"\u90E8":-878,"\u90FD":-2424,"\u914D":-878,"\u91CC":-878,"\u91CD":-878,"\u91D1":-2424,"\u9577":-878,"\u9580":-2424,"\u958B":-878,"\u9662":-1789,"\u969B":-878,"\u96C6":-878,"\u96E3":-878,"\u96FB":-878,"\u975E":1167,"\u97F3":-878,"\u9996":-878,"\u9AD8":-2424,"\u9BD6":-878};this.UW4__={",":3930,".":3508,"\u2015":-4841,"\u3001":3930,"\u3002":3508,"\u300C":4999,"\u300D":1895,"\u300D":3798,"\u3005":-5156,"\u3042":4752,"\u3044":-3435,"\u3046":-640,"\u3048":-2514,"\u304A":2405,"\u304B":530,"\u304C":6006,"\u304D":-4482,"\u304E":-3821,"\u304F":-3788,"\u3051":-4376,"\u3052":-4734,"\u3053":2255,"\u3054":1979,"\u3055":2864,"\u3057":-843,"\u3058":-2506,"\u3059":-731,"\u305A":1251,"\u305B":181,"\u305D":4091,"\u305F":5034,"\u3060":5408,"\u3061":-3654,"\u3063":-5882,"\u3064":-1659,"\u3066":3994,"\u3067":7410,"\u3068":4547,"\u306A":5433,"\u306B":6499,"\u306C":1853,"\u306D":1413,"\u306E":7396,"\u306F":8578,"\u3070":1940,"\u3072":4249,"\u3073":-4134,"\u3076":1345,"\u3078":6665,"\u307B":-744,"\u307E":1464,"\u307F":1051,"\u3080":-2082,"\u3081":-882,"\u3082":-5046,"\u3084":4169,"\u3088":2795,"\u3089":-1544,"\u308A":3338,"\u308B":1073,"\u308C":1861,"\u308D":-2412,"\u308F":-1897,"\u3092":-2979,"\u3093":5765,"\u30A2":-816,"\u30A6":3191,"\u30AB":2023,"\u30CD":-1052,"\u30CF":-960,"\u30EB":1804,"\u30F3":-1169,"\u4E00":1167,"\u4E0A":4228,"\u4E0B":-4245,"\u4E0D":14,"\u4E16":-1343,"\u4E2D":4271,"\u4E3B":1295,"\u4E57":0,"\u4E88":1168,"\u4E8B":2024,"\u4E8C":-1052,"\u4EBA":-1169,"\u4ECA":6620,"\u4ED5":3966,"\u4EE3":1567,"\u4EE5":3831,"\u4F1A":-4066,"\u4F1D":-1233,"\u4F4F":-1233,"\u4F53":-1632,"\u4F55":-1233,"\u4F59":-1500,"\u4F5C":1169,"\u4F7F":1169,"\u4FE1":1169,"\u5148":-1169,"\u5165":-1169,"\u5168":-1633,"\u516C":-1169,"\u5171":1169,"\u5185":-1169,"\u518D":1169,"\u51FA":1169,"\u521D":3831,"\u524D":-1169,"\u526F":-1169,"\u529B":-1169,"\u52A0":1169,"\u52D9":-1169,"\u52D5":-1169,"\u52D5":-1169,"\u5316":1169,"\u5317":-1169,"\u533A":-1169,"\u5348":-1169,"\u534A":-1169,"\u5357":-1169,"\u5358":5765,"\u53CD":1169,"\u53E3":-1169,"\u53E4":1169,"\u53F0":1169,"\u53F3":-1633,"\u5404":-1169,"\u540C":-1633,"\u540E":1169,"\u5411":1169,"\u544A":1169,"\u5468":1169,"\u548C":-1169,"\u54E1":1169,"\u5546":-1169,"\u554F":-1633,"\u56FD":5765,"\u571F":-1633,"\u5730":-1169,"\u5742":-1169,"\u578B":-1169,"\u5834":-1169,"\u58F2":-1633,"\u5909":5765,"\u5916":-1169,"\u5927":-1169,"\u592A":-1169,"\u5973":-1633,"\u5B50":-1169,"\u5B57":1169,"\u5B66":-1169,"\u5B9F":1169,"\u5BA2":-1169,"\u5BAE":1169,"\u5BFE":-1169,"\u5C0F":-1169,"\u5C11":-1169,"\u5C3E":-1169,"\u5C4B":-1633,"\u5C71":-1169,"\u5CF6":-1169,"\u5DDD":5765,"\u5DDE":-1169,"\u5E02":-1169,"\u5E30":1169,"\u5E73":1169,"\u5E74":-1169,"\u5E83":-1633,"\u5E97":-1169,"\u5F0F":-1169,"\u5F15":1169,"\u5F35":1169,"\u5F37":-1169,"\u5F53":-1169,"\u5F79":1169,"\u5F97":-1169,"\u5FA9":-1169,"\u5FB3":1169,"\u5FC3":-1169,"\u5FC5":-1169,"\u601D":-1169,"\u6025":-1169,"\u60C5":-1169,"\u60F3":-1169,"\u6210":-1633,"\u6226":1169,"\u623F":-1169,"\u6240":-1169,"\u624B":-1169,"\u6307":1169,"\u63A5":-1169,"\u63D0":-1169,"\u643A":1169,"\u653F":-1169,"\u6559":1169,"\u6570":-1633,"\u6574":-1169,"\u6587":-1169,"\u6599":-1169,"\u65B0":5765,"\u65E5":5765,"\u65E7":1169,"\u660E":-1169,"\u6625":1169,"\u6628":-1169,"\u6642":-1169,"\u66F8":-1169,"\u6700":-1169,"\u6708":5765,"\u6709":-1169,"\u671D":1169,"\u672B":-1169,"\u672C":5765,"\u6751":1169,"\u6771":-1169,"\u677E":1169,"\u6797":-1169,"\u6839":-1169,"\u683C":1169,"\u6848":1169,"\u696D":-1169,"\u6975":-1169,"\u697D":1169,"\u69CB":-1169,"\u6A5F":-1169,"\u6B21":-1633,"\u6B62":-1169,"\u6B63":-1169,"\u6B66":1169,"\u6B7B":-1169,"\u6C0F":-1169,"\u6C11":1169,"\u6C34":1169,"\u6C5F":1169,"\u6C7A":-1169,"\u6CBB":1169,"\u6CD5":-1169,"\u6D3E":-1169,"\u6D77":-1169,"\u6DF1":1169,"\u6E08":1169,"\u6E90":1169,"\u70B9":-1169,"\u7136":-1169,"\u7269":-1169,"\u7279":1169,"\u73FE":-1169,"\u7406":-1169,"\u751F":-1169,"\u7523":-1169,"\u7530":-1169,"\u7537":5765,"\u7684":-1169,"\u76EE":-1169,"\u76F4":1169,"\u7701":-1169,"\u77E5":1169,"\u77F3":-1169,"\u78BA":1169,"\u793E":-1169,"\u795E":-1169,"\u798F":-1169,"\u7A0B":-1169,"\u7A2E":-1169,"\u7A3B":1169,"\u7A7A":1169,"\u7ACB":1169,"\u7B2C":-1169,"\u7B49":1169,"\u7B56":-1169,"\u7C73":5765,"\u7D04":-1169,"\u7D30":-1169,"\u7D44":1169,"\u7D4C":5765,"\u7D50":1169,"\u7D9A":-1169,"\u7DCF":1169,"\u7F8E":-1169,"\u8077":-1169,"\u80FD":1169,"\u8208":-1169,"\u884C":-1169,"\u885B":-1169,"\u8868":-1633,"\u898B":1169,"\u898F":-1169,"\u89AA":-1169,"\u89E3":1169,"\u8A00":-1169,"\u8A08":1169,"\u8A18":5765,"\u8A2D":-1169,"\u8A31":1169,"\u8A71":1169,"\u8ABF":-1169,"\u8B70":-1169,"\u8CB7":1169,"\u8CBB":-1169,"\u8ECA":-1169,"\u8ECD":-1169,"\u8FBC":1169,"\u8FD1":-1169,"\u8FD4":-1169,"\u8FCE":1169,"\u8FD1":-1169,"\u9001":-1169,"\u9023":1169,"\u9032":-1169,"\u904E":-1169,"\u904B":-1169,"\u9053":-1169,"\u9054":1169,"\u9078":1169,"\u90CE":5765,"\u90E8":-1169,"\u90FD":-1633,"\u914D":-1169,"\u91CC":1169,"\u91CD":-1169,"\u91CE":-1169,"\u91D1":-1633,"\u9577":-1169,"\u9580":1169,"\u9593":-1169,"\u9662":1169,"\u969B":-1169,"\u96C6":-1169,"\u96E8":1169,"\u96FB":1169,"\u9818":1169,"\u984C":-1169,"\u99C5":1169,"\u9A13":1169};this.UW5__={",":465,".":-299,1:-514,"\u3001":465,"\u3002":-299,"\u300D":1168,"\u3042":-2613,"\u3044":1168,"\u3046":741,"\u3048":-1169,"\u304A":6203,"\u304B":-1169,"\u304C":5765,"\u304D":-1169,"\u304F":-1169,"\u3051":-1169,"\u3055":-1169,"\u3057":-1169,"\u3059":-1169,"\u305D":-1169,"\u305F":-4907,"\u3063":4999,"\u3066":-1169,"\u3067":-4907,"\u3068":-1169,"\u306A":5765,"\u306B":-1169,"\u306E":-1169,"\u306F":-1169,"\u3076":-1169,"\u307E":-1169,"\u3082":5765,"\u3084":-1169,"\u3088":-1169,"\u3089":-1169,"\u308A":-1169,"\u308B":5765,"\u308C":1002,"\u3093":5765,"\u30FC":-3604,"\u4E00":-1169,"\u4E09":-1169,"\u4E0A":1169,"\u4E0B":-1169,"\u4E0D":-1169,"\u4E16":-1169,"\u4E2D":-1169,"\u4E3B":-1169,"\u4E88":-1169,"\u4E8B":-1169,"\u4E8C":-1169,"\u4EBA":-1169,"\u4ECA":1169,"\u4ED5":-1169,"\u4EE3":1169,"\u4EE5":1169,"\u4F1A":-1169,"\u4F53":-1169,"\u4F55":-1169,"\u4F5C":-1169,"\u4F7F":1169,"\u4FE1":1169,"\u5148":-1169,"\u5165":-1169,"\u5168":5765,"\u516C":-1169,"\u5185":-1169,"\u51FA":1169,"\u524D":-1169,"\u526F":-1169,"\u529B":1169,"\u52D5":-1169,"\u5316":1169,"\u5317":-1169,"\u533A":-1169,"\u5348":-1169,"\u5357":-1169,"\u5358":-1169,"\u53E3":-1169,"\u53F0":-1169,"\u540C":-1169,"\u540D":-1169,"\u548C":1169,"\u5546":-1169,"\u56FD":5765,"\u5730":-1169,"\u578B":-1169,"\u5834":1169,"\u5909":-1169,"\u5916":-1169,"\u5927":-1169,"\u5973":-1169,"\u5B50":-1169,"\u5B66":1169,"\u5B9F":1169,"\u5BFE":-1169,"\u5C0F":-1169,"\u5C4B":-1169,"\u5C71":-1169,"\u5CF6":-1169,"\u5DDD":-1169,"\u5DDE":-1169,"\u5E02":-1169,"\u5E74":-1169,"\u5E83":-1169,"\u5F37":-1169,"\u5F53":-1169,"\u5F79":-1169,"\u5FA9":-1169,"\u5FC3":-1169,"\u601D":-1169,"\u6027":-1169,"\u60C5":-1169,"\u6210":-1169,"\u623F":-1169,"\u6240":-1169,"\u624B":-1169,"\u653F":-1169,"\u6559":-1169,"\u6570":-1169,"\u6587":-1169,"\u65B0":-1169,"\u65E5":-1169,"\u660E":-1169,"\u6642":-1169,"\u66F8":-1169,"\u6700":-1169,"\u6708":5765,"\u6709":-1169,"\u671D":-1169,"\u672B":-1169,"\u672C":-1169,"\u6771":-1169,"\u696D":-1169,"\u6B21":-1169,"\u6C11":-1169,"\u6C34":-1169,"\u6C7A":-1169,"\u6CBB":-1169,"\u6CD5":-1169,"\u6D3E":-1169,"\u6D77":-1169,"\u70B9":-1169,"\u7269":-1169,"\u73FE":-1169,"\u7406":-1169,"\u751F":-1169,"\u7530":-1169,"\u7537":-1169,"\u7684":5765,"\u76EE":-1169,"\u7701":-1169,"\u77E5":-1169,"\u793E":-1169,"\u795E":-1169,"\u7A2E":-1169,"\u7A7A":-1169,"\u7ACB":-1169,"\u7B2C":-1169,"\u7C73":-1169,"\u7D44":-1169,"\u7D4C":-1169,"\u7D50":-1169,"\u7D9A":-1169,"\u8077":-1169,"\u80FD":1169,"\u884C":-1169,"\u898B":-1169,"\u8A18":-1169,"\u8ABF":-1169,"\u8B70":-1169,"\u8CBB":-1169,"\u8ECA":-1169,"\u8ECD":-1169,"\u8FBC":-1169,"\u8FD1":-1169,"\u9053":-1169,"\u90E8":-1169,"\u90FD":-1169,"\u91D1":-1169,"\u9577":-1169,"\u9580":1169,"\u9662":-1169,"\u969B":-1169,"\u96C6":-1169,"\u97F3":-1169};this.UW6__={",":227,".":808,"1":-270,"\u3001":227,"\u3002":808,"\u300C":4889,"\u300D":5765,"\u3042":-1169,"\u3044":-1169,"\u3046":-1169,"\u3048":-1169,"\u3053":-1169,"\u3055":-1169,"\u3057":-1169,"\u3059":-1169,"\u305D":-1169,"\u305F":-1169,"\u3063":-1169,"\u3066":-1169,"\u3067":-1169,"\u3068":-1169,"\u306A":-1169,"\u306B":-1169,"\u306E":-1169,"\u306F":-1169,"\u307E":-1169,"\u3082":-1169,"\u3084":-1169,"\u3089":-1169,"\u308A":-1169,"\u308B":-1169,"\u308C":-1169,"\u308F":-1169,"\u3093":-1169,"\u30F3":-1169,"\u4E00":1169,"\u4E2D":1169,"\u4EBA":-1169,"\u4F1A":-1169,"\u524D":-1169,"\u5927":-1169,"\u5B66":-1169,"\u5C0F":-1169,"\u5E74":-1169,"\u5F53":-1169,"\u601D":-1169,"\u6240":-1169,"\u65B0":-1169,"\u65E5":-1169,"\u6642":-1169,"\u66F8":-1169,"\u6700":-1169,"\u6708":-1169,"\u672C":-1169,"\u6771":-1169,"\u6C11":-1169,"\u751F":-1169,"\u7530":-1169,"\u7684":-1169,"\u770C":-1169,"\u7ACB":-1169,"\u898B":-1169,"\u8ABF":-1169,"\u90FD":-1169,"\u91D1":-1169,"\u9577":-1169,"\u958B":-1169};this.segment=function(e){if(e==null||e==undefined||e=="")return[];var r=[];var a=["B3","B2","B1"];var n=["O","O","O"];for(var i=0;i<e.length;++i){a.push(e.charAt(i));n.push(this.chartype_(e.charAt(i)))}a.push("E1");a.push("E2");a.push("E3");n.push("O");n.push("O");n.push("O");var s=a.length;var o="";for(var i=4;i<s-3;++i){var h=this.BIAS__;var c;c=this.ts_(this.UP1__[n[i-3]]);h+=c;c=this.ts_(this.UP2__[n[i-2]]);h+=c;c=this.ts_(this.UP3__[n[i-1]]);h+=c;c=this.ts_(this.BP1__[n[i-3]+n[i-2]]);h+=c;c=this.ts_(this.BP2__[n[i-2]+n[i-1]]);h+=c;c=this.ts_(this.UW1__[a[i-3]]);h+=c;c=this.ts_(this.UW2__[a[i-2]]);h+=c;c=this.ts_(this.UW3__[a[i-1]]);h+=c;c=this.ts_(this.UW4__[a[i]]);h+=c;c=this.ts_(this.UW5__[a[i+1]]);h+=c;c=this.ts_(this.UW6__[a[i+2]]);h+=c;c=this.ts_(this.BW1__[a[i-2]+a[i-1]]);h+=c;c=this.ts_(this.BW2__[a[i-1]+a[i]]);h+=c;c=this.ts_(this.BW3__[a[i]+a[i+1]]);h+=c;c=this.ts_(this.TC1__[n[i-3]+n[i-2]+n[i-1]]);h+=c;c=this.ts_(this.TC2__[n[i-2]+n[i-1]+n[i]]);h+=c;c=this.ts_(this.TC3__[n[i-1]+n[i]+n[i+1]]);h+=c;c=this.ts_(this.TC4__[n[i]+n[i+1]+n[i+2]]);h+=c;c=this.ts_(this.UQ1__[n[i-3]+n[i-2]+n[i-1]+n[i]]);h+=c;c=this.ts_(this.UQ2__[n[i-2]+n[i-1]+n[i]+n[i+1]]);h+=c;c=this.ts_(this.UQ3__[n[i-1]+n[i]+n[i+1]+n[i+2]]);h+=c;c=this.ts_(this.BQ1__[n[i-2]+n[i-1]+n[i]+n[i+1]+a[i-2]+a[i-1]+a[i]].substr(0,1));h+=c;c=this.ts_(this.BQ2__[n[i-1]+n[i]+n[i+1]+n[i+2]+a[i-1]+a[i]+a[i+1]].substr(0,1));h+=c;c=this.ts_(this.BQ3__[n[i]+n[i+1]+n[i+2]+n[i+3]+a[i]+a[i+1]+a[i+2]].substr(0,1));h+=c;c=this.ts_(this.BQ4__[n[i+1]+n[i+2]+n[i+3]+a[i+1]+a[i+2]+a[i+3]]);h+=c;c=this.ts_(this.TW1__[a[i-3]+a[i-2]+a[i-1]]);h+=c;c=this.ts_(this.TW2__[a[i-2]+a[i-1]+a[i]]);h+=c;c=this.ts_(this.TW3__[a[i-1]+a[i]+a[i+1]]);h+=c;c=this.ts_(this.TW4__[a[i]+a[i+1]+a[i+2]]);h+=c;if(h>0){r.push(o);o=""}o+=a[i]}r.push(o);return r}}

(function() {
  var segmenter = new TinySegmenter();

  // ストップワード（助詞・記号・一般的すぎる語）
  var STOP_WORDS = [
    'の', 'に', 'は', 'を', 'た', 'が', 'で', 'て', 'と', 'し', 'れ', 'さ',
    'ある', 'いる', 'も', 'する', 'から', 'な', 'こと', 'として', 'い', 'や',
    'れる', 'など', 'なっ', 'ない', 'この', 'ため', 'その', 'あっ', 'よう',
    'また', 'もの', 'という', 'あり', 'まで', 'られ', 'なる', 'へ', 'か',
    'だ', 'これ', 'によって', 'により', 'おり', 'より', 'による', 'ず', 'なり',
    'られる', 'において', 'ば', 'なかっ', 'なく', 'しかし', 'について', 'せ',
    'だっ', 'その他', 'よる', 'ほか', 'ほど', 'のみ', 'つつ', 'ほとんど',
    'それ', 'ところ', 'ただし', 'ただ', 'ので', 'ながら', 'うち',
    // 記号
    ' ', '　', '/', '/', '(', ')', '（', '）', '【', '】', '「', '」',
    '[', ']', '{', '}', '!', '！', '?', '？', ':', '：', ';', '；',
    ',', '、', '.', '。', '-', 'ー', '~', '～', '・', '×', '★', '☆',
    '●', '◆', '■', '▲', '▼', '◎', '○', '♪', '→', '←', '↓', '↑',
    '※', '#', '＃', '&', '＆', '%', '％', '+', '＋', '=', '＝',
    '"', '"', '"', '\'', ''', ''', '|', '｜', '\\', '＼', '_', '＿',
    '<', '>', '＜', '＞', '^', '＾', '`',
    '\n', '\r', '\t', '...', '…',
    // 数字・単位でよく出る短い語
    'x', 'X', '×'
  ];

  var stopSet = {};
  STOP_WORDS.forEach(function(w) { stopSet[w] = true; });

  function isStopWord(word) {
    if (stopSet[word]) return true;
    // 1文字のひらがな・カタカナ
    if (word.length === 1 && /^[\u3041-\u309F\u30A1-\u30FF]$/.test(word)) return true;
    // 空白のみ
    if (/^\s+$/.test(word)) return true;
    return false;
  }

  function analyzeWords(itemNames) {
    var wordCount = {};

    itemNames.forEach(function(name) {
      var words = segmenter.segment(name);
      words.forEach(function(word) {
        var w = word.trim();
        if (w === '') return;
        if (!wordCount[w]) {
          wordCount[w] = 0;
        }
        wordCount[w]++;
      });
    });

    // オブジェクトを配列に変換
    var result = [];
    for (var word in wordCount) {
      result.push({ word: word, count: wordCount[word] });
    }

    // 回数で降順ソート
    result.sort(function(a, b) { return b.count - a.count; });
    return result;
  }

  function renderTable(wordData, minCount, filterStopwords) {
    var tbody = $('#freqTable tbody');
    tbody.empty();

    var filtered = wordData.filter(function(item) {
      if (item.count < minCount) return false;
      if (filterStopwords && isStopWord(item.word)) return false;
      return true;
    });

    if (filtered.length === 0) {
      tbody.append('<tr><td colspan="4" class="text-center text-muted">該当する単語がありません</td></tr>');
      return;
    }

    var maxCount = filtered[0].count;

    filtered.forEach(function(item, index) {
      var pct = Math.round((item.count / maxCount) * 100);
      var row = '<tr>' +
        '<td>' + (index + 1) + '</td>' +
        '<td><strong>' + escapeHtml(item.word) + '</strong></td>' +
        '<td>' + item.count + '</td>' +
        '<td><div class="freq-bar" style="width: ' + pct + '%"></div></td>' +
        '</tr>';
      tbody.append(row);
    });
  }

  function escapeHtml(str) {
    return str.replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/>/g, '&gt;').replace(/"/g, '&quot;');
  }

  var currentWordData = null;

  function updateDisplay() {
    if (!currentWordData) return;
    var minCount = parseInt($('#minCount').val()) || 1;
    var filterStopwords = $('#filterStopwords').is(':checked');
    renderTable(currentWordData, minCount, filterStopwords);
  }

  $('#minCount').on('change', updateDisplay);
  $('#filterStopwords').on('change', updateDisplay);

  $('#searchForm').on('submit', function(e) {
    e.preventDefault();

    var appId = $('#appId').val().trim();
    var keyword = $('#keyword').val().trim();

    if (!appId) {
      alert('楽天APIのアプリIDを入力してください。');
      return;
    }
    if (!keyword) {
      alert('検索キーワードを入力してください。');
      return;
    }

    // localStorage にアプリIDを保存
    try { localStorage.setItem('rakuten_app_id', appId); } catch(e) {}

    $('#loading').show();
    $('#results').hide();
    $('#error').hide();

    $.ajax({
      url: 'https://app.rakuten.co.jp/services/api/IchibaItem/Search/20170706',
      dataType: 'jsonp',
      data: {
        applicationId: appId,
        keyword: keyword,
        hits: 30,
        sort: 'standard'
      },
      success: function(data) {
        $('#loading').hide();

        if (!data.Items || data.Items.length === 0) {
          $('#error').text('検索結果が0件でした。別のキーワードをお試しください。').show();
          return;
        }

        var itemNames = data.Items.map(function(item) {
          return item.Item.itemName;
        });

        // 商品名一覧を表示
        var list = $('#productList');
        list.empty();
        $('#itemCount').text(itemNames.length);
        itemNames.forEach(function(name) {
          list.append('<li>' + escapeHtml(name) + '</li>');
        });

        // 単語頻度分析
        currentWordData = analyzeWords(itemNames);
        $('#resultMeta').text('（キーワード: ' + keyword + ' / ' + itemNames.length + '件）');
        $('#results').show();
        updateDisplay();
      },
      error: function(xhr, status, err) {
        $('#loading').hide();
        $('#error').text('APIリクエストに失敗しました: ' + (err || status)).show();
      }
    });
  });

  // localStorage からアプリIDを復元
  try {
    var savedId = localStorage.getItem('rakuten_app_id');
    if (savedId) $('#appId').val(savedId);
  } catch(e) {}
})();
</script>
</body>
</html>
